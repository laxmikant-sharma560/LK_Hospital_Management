{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LK Hospital Management</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Vanta.js and Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.topology.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    html, body { height: 100%; margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    #vanta-bg { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -10; }
    .glass { background: rgba(255,255,255,0.18); backdrop-filter: blur(13px);}
    .stat-card {
      transition: transform 0.2s cubic-bezier(.4,0,.2,1), box-shadow 0.2s, background 0.3s;
      background: linear-gradient(135deg, #e0e7ff 0%, #fce7f3 100%);
      border: 1px solid #f5d0fe;
    }
    .stat-card:hover {
      transform: translateY(-6px) scale(1.05) rotate(-2deg);
      box-shadow: 0 8px 24px 0 rgba(139,92,246,.25), 0 2px 8px 0 rgba(236,72,153,.13);
      background: linear-gradient(120deg, #f0abfc 0%, #a7f3d0 100%);
    }
    .nav-item.active, .nav-item:active {
      background: linear-gradient(90deg, #4f46e5 0%, #f472b6 100%);
      color: white;
      scale: 1.07;
    }
    .navbar-btn {
      color: #fff;
      border-radius: 0.75rem;
      font-weight: 500;
      transition: all 0.2s cubic-bezier(.4,0,.2,1);
      background: linear-gradient(120deg, #818cf8 0%, #f472b6 40%, #34d399 100%);
      box-shadow: 0 2px 12px 0 rgba(129,140,248,0.12);
      position: relative;
    }
    .navbar-btn:hover, .navbar-btn.active {
      background: linear-gradient(90deg, #f472b6 10%, #818cf8 70%, #facc15 100%);
      color: #fff;
      scale: 1.05;
      box-shadow: 0 4px 24px 0 rgba(236,72,153,0.15);
    }
    .fadein { animation: fadein 1s ease;}
    @keyframes fadein {
      from { opacity: 0; transform: translateY(30px);}
      to { opacity: 1; transform: none;}
    }
    .glass-footer { background: linear-gradient(90deg,#f3e8ff 0%,#f1f5f9 100%,#fce7f3 100%); backdrop-filter: blur(12px);}
    ::-webkit-scrollbar { width: 7px; background: transparent;}
    ::-webkit-scrollbar-thumb { background: linear-gradient(135deg,#f9a8d4 0,#a5b4fc 100%); border-radius: 10px;}
    .dropdown-content {
      display: none;
      position: absolute;
      top: 110%;
      left: 0;
      min-width: 180px;
      z-index: 50;
      background: linear-gradient(120deg, #e0e7ff 0%, #fce7f3 100%);
      box-shadow: 0 4px 24px 0 rgba(236,72,153,0.08);
      border-radius: 0.75rem;
      padding: 0.5rem 0;
    }
    .dropdown:hover .dropdown-content, .dropdown:focus-within .dropdown-content {
      display: block;
    }
    .dropdown-content a {
      color: #4f46e5;
      padding: 0.5rem 1.25rem;
      display: block;
      text-decoration: none;
      border-radius: 0.5rem;
      font-weight: 500;
    }
    .dropdown-content a:hover {
      background: linear-gradient(90deg, #818cf8 10%, #f472b6 70%);
      color: #fff;
    }
  </style>
</head>
<body class="bg-gradient-to-tr from-fuchsia-100 via-blue-100 to-green-100">
  <!-- Vanta Background -->
  <div id="vanta-bg"></div>

  <!-- TOP NAVBAR WITH DROPDOWNS -->
  <header class="w-full z-20 py-3 px-0 md:px-12 shadow-xl glass fixed top-0 left-0 flex flex-col md:flex-row items-center justify-between" style="background: linear-gradient(120deg,#818cf8 0%,#f472b6 40%,#facc15 70%,#34d399 100%);">
    <div class="flex items-center gap-3">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSsRbNptqhM0Xb7rXIlBjuq5nLYyx6Tv7fxWA&s" class="w-12 h-12 rounded-full border-4 border-white shadow-lg" alt="Hospital Logo" />
      <span class="text-2xl font-bold drop-shadow text-white">LK Hospital</span>
    </div>
    <nav class="flex flex-wrap items-center gap-2 md:gap-4 mt-3 md:mt-0 relative">
      <a href="{% url 'home' %}" class="navbar-btn nav-item px-4 py-2 text-base md:text-lg transition flex items-center gap-2 active" data-nav-index="0">
        <span class="text-xl">🏠</span>
        <span>Dashboard</span>
      </a>
      <!-- Dropdown for Management -->
      <div class="dropdown relative">
        <button class="navbar-btn nav-item px-4 py-2 text-base md:text-lg flex items-center gap-2 focus:outline-none">
          <span class="text-xl">🗂️</span>
          <span>Management</span>
          <svg class="w-4 h-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
        </button>
        <div class="dropdown-content">
          <a href="{% url 'patients' %}" id="patients-link">🧑‍🤝‍🧑 Patients</a>
          <a href="{% url 'doctors' %}" id="doctors-link">👨‍⚕️ Doctors</a>
          <a href="{% url 'appointments' %}" id="appointments-link">📅 Appointments</a>
          <a href="{% url 'billing' %}" id="billing-link">💳 Billing</a>
        </div>
      </div>
      <!-- Dropdown for More -->
      <div class="dropdown relative">
        <button class="navbar-btn nav-item px-4 py-2 text-base md:text-lg flex items-center gap-2 focus:outline-none">
          <span class="text-xl">☰</span>
          <span>More</span>
          <svg class="w-4 h-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
        </button>
        <div class="dropdown-content right-0 left-auto">
          <a href="{% url 'settings' %}" id="settings-link">⚙️ Settings</a>
          <a href="{% url 'about' %}" id="about-link">ℹ️ About</a>
          <a href="{% url 'contact' %}" id="contact-link">📞 Contact</a>
        </div>
      </div>
      {% if user.is_authenticated %}
      <div class="dropdown relative">
        <button class="navbar-btn nav-item px-4 py-2 text-base md:text-lg flex items-center gap-2 focus:outline-none">
          <span class="text-xl">👤</span>
          <span>{{ user.username }}</span>
          <svg class="w-4 h-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
        </button>
        <div class="dropdown-content right-0 left-auto">
          <a href="{% url 'settings' %}">⚙️ Settings</a>
          <a href="{% url 'logout' %}">🚪 Logout</a>
        </div>
      </div>
      {% else %}
      <div class="dropdown relative">
        <button class="navbar-btn nav-item px-4 py-2 text-base md:text-lg flex items-center gap-2 focus:outline-none">
          <span class="text-xl">👤</span>
          <span>Account</span>
          <svg class="w-4 h-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
        </button>
        <div class="dropdown-content right-0 left-auto">
          <a href="{% url 'login' %}" id="login-link">🔑 Login</a>
          <a href="{% url 'register' %}" id="register-link">📝 Register</a>
        </div>
      </div>
      {% endif %}
    </nav>
  </header>

  <!-- Main Content with padding-top for navbar -->
  <main class="flex-1 p-3 md:p-10 pt-28 overflow-y-auto glass rounded-xl shadow-xl relative min-h-screen" style="background: linear-gradient(120deg,#f0abfc 0,#a7f3d0 100%);">
    <section class="fadein" id="section-dashboard">
      <!-- Hero Section -->
      <div class="flex flex-col md:flex-row items-center justify-between gap-6 mb-10">
        <div>
          <h2 class="text-3xl md:text-4xl font-bold mb-2 text-indigo-700">
            Welcome{% if user.is_authenticated %}, {{ user.username }}{% endif %} to <span class="text-pink-500">LK Hospital</span>
          </h2>
          <p class="text-lg text-gray-700 max-w-xl">Your health, our priority. Manage patients, doctors, appointments, and more—effortlessly.</p>
        </div>
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSsRbNptqhM0Xb7rXIlBjuq5nLYyx6Tv7fxWA&s" alt="Hospital Avatar" class="rounded-full border-4 border-indigo-400 shadow-lg animate-pulse" />
      </div>

      <!-- Quick Stats -->
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 mb-8">
        <div class="stat-card flex flex-col items-center cursor-pointer group">
          <img src="https://randomuser.me/api/portraits/women/44.jpg" class="w-10 h-10 rounded-full border-2 border-pink-300 mb-2" alt="Patients" />
          <div class="text-3xl font-bold mb-1 group-hover:text-pink-500 transition">{{ total_patients }}</div>
          <div class="text-indigo-700 group-hover:text-pink-400 transition">Patients</div>
        </div>
        <div class="stat-card flex flex-col items-center cursor-pointer group">
          <img src="https://randomuser.me/api/portraits/men/45.jpg" class="w-10 h-10 rounded-full border-2 border-indigo-300 mb-2" alt="Doctors" />
          <div class="text-3xl font-bold mb-1 group-hover:text-indigo-500 transition">{{ total_doctors }}</div>
          <div class="text-pink-700 group-hover:text-indigo-400 transition">Doctors</div>
        </div>
        <div class="stat-card flex flex-col items-center cursor-pointer group">
          <img src="https://placehold.co/40x40?text=📅" class="w-10 h-10 rounded-full border-2 border-green-300 mb-2" alt="Appointments" />
          <div class="text-3xl font-bold mb-1 group-hover:text-green-500 transition">{{ total_appointments }}</div>
          <div class="text-indigo-700 group-hover:text-green-400 transition">Appointments</div>
        </div>
        <div class="stat-card flex flex-col items-center cursor-pointer group">
          <img src="https://placehold.co/40x40?text=₹" class="w-10 h-10 rounded-full border-2 border-yellow-300 mb-2" alt="Billing" />
          <div class="text-3xl font-bold mb-1 group-hover:text-yellow-500 transition">₹{{ total_billing }}</div>
          <div class="text-pink-700 group-hover:text-yellow-400 transition">Billing</div>
        </div>
      </div>

      <!-- Recent Appointments Table -->
      <div class="max-w-4xl mx-auto mb-8">
        <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-2">
          <h3 class="text-2xl font-semibold text-indigo-700">Recent Appointments</h3>
          <a href="{% url 'add_appointment' %}" class="text-blue-500 hover:underline font-medium transition">View all</a>
        </div>
        <div class="overflow-x-auto rounded-lg shadow-lg bg-white/90">
          <table class="min-w-full divide-y divide-indigo-100/80 table-fixed">
            <colgroup>
              <col style="width: 30%;">
              <col style="width: 30%;">
              <col style="width: 20%;">
              <col style="width: 20%;">
            </colgroup>
            <thead class="bg-gradient-to-r from-blue-100 via-pink-100 to-green-100">
              <tr>
                <th class="px-4 py-3 text-left text-xs font-semibold text-indigo-800 uppercase tracking-wider">Patient</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-indigo-800 uppercase tracking-wider">Doctor</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-indigo-800 uppercase tracking-wider">Date</th>
                <th class="px-4 py-3 text-left text-xs font-semibold text-indigo-800 uppercase tracking-wider">Symptoms</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-indigo-50">
              {% for appt in recent_appointments %}
              <tr class="hover:bg-gradient-to-l hover:from-fuchsia-50/60 hover:to-blue-50/60 transition">
                <td class="px-4 py-3 whitespace-nowrap">
                  <div class="flex items-center gap-2">
                    <img src="https://randomuser.me/api/portraits/men/{{ forloop.counter0|add:20 }}.jpg" class="w-8 h-8 rounded-full border border-pink-200 shadow" alt="Patient Avatar">
                    <span class="font-medium text-gray-900 truncate block max-w-[120px]">{{ appt.patient_name }}</span>
                  </div>
                </td>
                <td class="px-4 py-3 whitespace-nowrap">
                  <div class="flex items-center gap-2">
                    <img src="https://randomuser.me/api/portraits/men/{{ forloop.counter0|add:40 }}.jpg" class="w-8 h-8 rounded-full border border-indigo-200 shadow" alt="Doctor Avatar">
                    <span class="font-medium text-gray-900 truncate block max-w-[120px]">{{ appt.doctor_name }}</span>
                  </div>
                </td>
                <td class="px-4 py-3 whitespace-nowrap">
                  <span class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded text-xs font-semibold">{{ appt.appointment_date }}</span>
                </td>
                <td class="px-4 py-3">
                  <span class="text-gray-700 truncate block max-w-[120px]" title="{{ appt.symptoms }}">{{ appt.symptoms|truncatechars:20 }}</span>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="4" class="text-center text-gray-400 py-6 text-base">No recent appointments.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Appointments Overview Chart -->
      <div class="glass border border-white/40 rounded-xl shadow p-6 fadein">
        <h3 class="text-2xl font-semibold mb-4 text-indigo-700">Appointments Overview</h3>
        <canvas id="appointmentsChart" class="rounded w-full max-w-xl mx-auto"></canvas>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="w-full glass-footer py-3 px-6 text-center text-gray-600 text-sm fixed bottom-0 left-0 z-20">© 2025 LK Hospital. All rights reserved.</footer>

  <script>
    VANTA.TOPOLOGY({
      el: "#vanta-bg",
      mouseControls: true,
      touchControls: true,
      gyroControls: false,
      minHeight: 200.00,
      minWidth: 200.00,
      scale: 1.0,
      scaleMobile: 1.0,
      color: 0xff00ff,
      backgroundColor: 0x111111,
      points: 12.0,
      maxDistance: 25.0,
      spacing: 20.0
    });

    // Chart.js for Appointments Overview
    const ctx = document.getElementById('appointmentsChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
        datasets: [{
          label: 'Appointments',
          data: [12, 19, 9, 14, 10, 6, 15],
          backgroundColor: 'rgba(129, 140, 248, .2)',
          borderColor: '#818cf8',
          borderWidth: 2,
          fill: true,
          tension: 0.4,
          pointRadius: 4,
          pointBackgroundColor: '#f472b6'
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true, ticks: { color: '#3b0764' }, grid: { color: 'rgba(129, 140, 248, .15)'} },
          x: { ticks: { color: '#3b0764' }, grid: { color: 'rgba(236,72,153,.07)'} }
        }
      }
    });
  </script>
</body>
</html>